<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover, maximum-scale=1.0, user-scalable=no">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#0a0a0a">

  <!-- PWA -->
  <link rel="manifest" href="/manifest.json">
  <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">
  <meta name="apple-mobile-web-app-title" content="Horizont IA">

  <title>Horizont IA - Consultor Inteligente</title>

  <style>
    /* Reset e variáveis */
    * { margin: 0; padding: 0; box-sizing: border-box; }
    :root { --vh: 1vh; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: #0a0a0a; color: #e0e0e0;
      height: calc(var(--vh,1vh)*100);
      overflow: hidden; position: fixed; width: 100%;
    }

    /* Login Screen */
    .login-container {
      display: flex; align-items: center; justify-content: center;
      height: calc(var(--vh,1vh)*100);
      padding: 20px;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
    }
    .login-box {
      background: rgba(255,255,255,0.05); backdrop-filter: blur(10px);
      border: 1px solid rgba(255,255,255,0.1); border-radius: 20px;
      padding: 40px; width: 100%; max-width: 400px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }
    .login-logo { text-align: center; margin-bottom: 30px; }
    .login-logo img { width: 120px; height: auto; margin-bottom: 20px; }
    .login-logo h1 {
      font-size: 28px; font-weight: 700;
      background: linear-gradient(45deg, #ffd700, #ffed4e);
      background-clip: text; -webkit-background-clip: text;
      -webkit-text-fill-color: transparent; margin-bottom: 10px;
    }
    .login-logo p { color: #888; font-size: 14px; }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; color: #bbb; font-size: 14px; }
    .form-group input {
      width: 100%; padding: 12px 16px;
      background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
      border-radius: 10px; color: #fff; font-size: 16px; transition: all .3s;
    }
    .form-group input:focus {
      outline: none; border-color: #0099ff;
      background: rgba(255,255,255,0.08);
    }
    .login-button {
      width: 100%; padding: 14px; background: #ffd700;
      border: none; border-radius: 10px; color: #000;
      font-size: 16px; font-weight: 700; cursor: pointer;
      transition: all .3s; margin-top: 10px;
    }
    .login-button:hover {
      background: #ffed4e; transform: translateY(-2px);
      box-shadow: 0 5px 20px rgba(255,215,0,0.3);
    }
    .login-button:active { transform: translateY(0); }
    .error-message {
      background: rgba(255,59,48,0.1); border:1px solid rgba(255,59,48,0.3);
      color: #ff3b30; padding: 12px; border-radius: 8px;
      margin-bottom: 20px; font-size: 14px; display: none;
    }

    /* Main App Container */
    .app-container {
      display: none; height: calc(var(--vh,1vh)*100);
      background: #0a0a0a; position: relative; overflow: hidden;
      display: flex; flex-direction: column;
    }
    /* Header */
    .header {
      background: rgba(20,20,20,0.8); backdrop-filter: blur(10px);
      border-bottom: 1px solid rgba(255,255,255,0.1);
      padding: 15px 20px; padding-top: calc(15px + env(safe-area-inset-top));
      display: flex; align-items: center; justify-content: space-between;
      z-index:1000;
    }
    .header-left { display: flex; align-items: center; gap:15px; }
    .menu-toggle {
      background:none; border:none; color:#fff; font-size:24px;
      cursor:pointer; padding:5px; display:none;
    }
    .logo-header { display:flex; align-items:center; gap:10px; }
    .logo-header img { width:40px; height:40px; }
    .logo-header h2 {
      font-size:20px; background:linear-gradient(45deg,#ffd700,#ffed4e);
      background-clip:text; -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
    }
    .user-info { display:flex; align-items:center; gap:15px; }
    .user-name { color:#bbb; font-size:14px; }
    .logout-btn { background:none; border:none; color:#fff; cursor:pointer; }

    /* Sidebar */
    .sidebar { background:rgba(20,20,20,0.8); backdrop-filter:blur(10px);
      width:260px; flex-shrink:0; overflow-y:auto; padding:20px;
      transform:translateX(0);
    }
    .sidebar.open { transform:translateX(0); }
    .new-chat-btn {
      display:flex; align-items:center; justify-content:center;
      width:100%; padding:12px; background:#ffd700; border:none;
      border-radius:8px; color:#000; font-weight:700; cursor:pointer;
      margin-bottom:15px;
    }
    .chat-list { display:flex; flex-direction:column; gap:10px; }
    .chat-item {
      padding:10px 15px; background:rgba(255,255,255,0.05);
      border-radius:8px; cursor:pointer; display:flex;
      align-items:center; justify-content:space-between;
    }
    .chat-item.active { background:#333; }
    .chat-title { flex:1; white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
    .chat-actions { display:flex; gap:5px; }
    .chat-action-btn { background:none; border:none; color:#fff; cursor:pointer; }

    /* Chat Area */
    .chat-area {
      display:flex; flex-direction:column; flex:1; overflow:hidden;
    }
    .messages-container {
      flex:1; overflow-y:auto; padding:15px;
      -webkit-overflow-scrolling:touch; overscroll-behavior:contain;
    }
    .input-area {
      padding:15px; padding-bottom:calc(15px+env(safe-area-inset-bottom));
      background:rgba(20,20,20,0.9); display:flex; flex-direction:column;
    }
    .message-input-wrapper { display:flex; align-items:flex-end; gap:8px; }
    .message-input {
      flex:1; resize:none; padding:10px; border-radius:8px;
      background:rgba(255,255,255,0.05); border:1px solid rgba(255,255,255,0.1);
      color:#fff; font-size:14px; line-height:1.4;
    }
    .attach-btn { background:none; border:none; color:#fff; font-size:20px; cursor:pointer; }
    #sendBtn {
      margin-top:10px; padding:12px; background:#0099ff; border:none;
      border-radius:8px; color:#fff; font-weight:700; cursor:pointer;
    }

    /* Leads View (oculto por padrão) */
    .leads-view { display:none; flex-direction:column; padding:15px; }
    /* Admin Panel (oculto) */
    .admin-panel { display:none; padding:20px; }

    /* Chart Container */
    .chart-container {
      margin:20px 0; padding:20px;
      background:rgba(255,255,255,0.02); border:1px solid rgba(255,255,255,0.1);
      border-radius:12px; position:relative;
    }
    .chart-container canvas {
      max-width:100%; height:300px!important;
    }
    .chart-expand-btn {
      position:absolute; top:10px; right:10px;
      background:rgba(255,255,255,0.1); border:1px solid rgba(255,255,255,0.2);
      color:#fff; padding:5px 10px; border-radius:5px;
      font-size:12px; cursor:pointer; display:none;
    }

    /* Expanded Chart */
    .chart-container.expanded {
      position:fixed!important; bottom:0; left:0; right:0;
      width:100vw!important; height:50vh!important; margin:0; padding:20px;
      background:rgba(20,20,20,0.95); z-index:10000; transform:none!important;
    }
    .chart-container.expanded canvas {
      width:100%!important; height:calc(100% - 40px)!important;
    }
    .chart-container.expanded .chart-expand-btn {
      display:block!important; z-index:10001; top:10px; right:10px;
    }

    /* iOS & Keyboard */
    @supports (-webkit-touch-callout:none) {
      .app-container { height:-webkit-fill-available; }
    }
    body.keyboard-open .input-area { position:fixed; bottom:0; left:0; right:0; z-index:10002; }
    body.keyboard-open .messages-container { padding-bottom:100px; }

    /* Mobile sidebar overlay */
    .sidebar-overlay {
      position:fixed; top:0; left:0; right:0; bottom:0;
      background:rgba(0,0,0,0.5); display:none; z-index:999;
    }
    .sidebar.open ~ .sidebar-overlay { display:block; }
  </style>
</head>
<body>
  <div class="sidebar-overlay" onclick="closeSidebar()"></div>

  <!-- Login Screen -->
  <div class="login-container" id="loginScreen">
    <div class="login-box">
      <div class="login-logo">
        <img src="logo.png" alt="Horizont Logo" onerror="this.style.display='none'">
        <h1>Horizont IA</h1>
        <p>Consultor Inteligente</p>
      </div>
      <div class="error-message" id="loginError"></div>
      <form id="loginForm" onsubmit="handleLogin(event)">
        <div class="form-group">
          <label for="username">Usuário</label>
          <input type="text" id="username" name="username" required autocomplete="username">
        </div>
        <div class="form-group">
          <label for="password">Senha</label>
          <input type="password" id="password" name="password" required autocomplete="current-password">
        </div>
        <button type="submit" class="login-button">Entrar</button>
      </form>
    </div>
  </div>

  <!-- Main App -->
  <div class="app-container" id="appContainer">
    <header class="header">
      <div class="header-left">
        <button class="menu-toggle" onclick="toggleSidebar()">☰</button>
        <div class="logo-header">
          <img src="logo.png" alt="Horizont" onerror="this.style.display='none'">
          <h2>Horizont IA</h2>
        </div>
      </div>
      <div class="user-info">
        <span class="user-name" id="userName"></span>
        <button class="logout-btn" onclick="handleLogout()">Sair</button>
      </div>
    </header>

    <div class="main-content" style="display:flex; flex:1; overflow:hidden;">
      <aside class="sidebar" id="sidebar">
        <button class="new-chat-btn" onclick="createNewChat()">+ Nova Conversa</button>
        <div class="chat-list" id="chatList"></div>
        <div class="sidebar-section" id="leadsSection" style="display:none;">
          <button class="leads-btn" onclick="toggleLeadsView()">📊 Meus Leads</button>
        </div>
        <div class="company-links" id="companyLinks" style="display:none;">
          <a href="https://horizontinvestimentos.com.br" target="_blank">🌐 Site Oficial</a>
          <a href="https://areahorizontinvestimentos.com.br" target="_blank">👤 Área do Cliente</a>
          <a href="https://wa.me/5511976859406" target="_blank">📱 WhatsApp</a>
          <a href="https://instagram.com/horizontinvestimentos" target="_blank">📸 Instagram</a>
        </div>
      </aside>

      <main class="chat-area" id="chatArea">
        <div class="messages-container" id="messagesContainer"></div>
        <div class="input-area">
          <div id="filePreview"></div>
          <div class="message-input-wrapper">
            <textarea
              id="messageInput"
              class="message-input"
              placeholder="Digite sua mensagem."
              rows="1"
              onkeydown="handleInputKeydown(event)"
              oninput="autoResizeTextarea(this)"
            ></textarea>
            <button class="attach-btn" onclick="document.getElementById('fileInput').click()">📎</button>
            <input
              type="file"
              id="fileInput"
              style="display:none;"
              accept=".pdf,jpg,jpeg,png,gif,webp"
              onchange="handleFileSelect(event)"
              multiple
            >
          </div>
          <button id="sendBtn" onclick="sendMessage()">Enviar</button>
        </div>
      </main>

      <div class="leads-view" id="leadsView"></div>
      <div class="admin-panel" id="adminPanel"></div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
